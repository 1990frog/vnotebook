[TOC]

# 什么场景中会用到多线程？

什么时候需要新开线程？
通常在需要进行耗时任务的时候，例如执行磁盘IO读写

为了同时做多件不同的事
开网页同时听音乐
后台线程：比如执行定时任务quartz

为了提高工作效率、处理能力
tomcat
多线程后台并行下载文件
NIO和AIO

需要同时有很大并发量的时候
压测

# 多线程的局限
上下文切换带来的消耗
异构化任务（任务结构不一样）很难高效并行


# 线程与进程

![](_v_images/20191023214303817_775910896.png)

## Oracle文档的官方定义
process：使用fork(2)系统调用创建的unix环境（例如文件描述符，用户id等），它被设置位运行程序。
thread：在进程上下文中执行的一系列指令。

## 悟空的解释
进程的英文是process，指的是程序的一次执行。在用户下达运行程序的命令后，就会产生进程。进程是对代码的实例化。
活动监视器展示的就是进程
ps aux
![](_v_images/20191023215140359_572581429.png)

总结：进程是程序（这里可以理解为我们写的代码）的真正运行实例，是资源分配的基本单位。

类比：
进程是一个房子，而线程是住户，房子不是做事的，做事的是房子中的人，所以进程是线程的容器。

# 线程与进程的不同
## 起源不同
先用进程后有线程，后来由于处理器的速度要比外设（输入设备、硬盘）快，所以为了提高CPU的利用率，才诞生了线程。目的就是提高程序的执行效率
## 概念不同
进程是拥有独立功能的一个程序运行起来的一个活动，是一个实例；它也是我们系统分配资源和调度的独立的单位。而线程是CPU的独立调度单位。
## 内存共享方式不同
对应进程而言，不同的进程之间它们都会被操作系统分配内存，但是不同进程的内存通常是不共享的，比如说我们的浏览器无法访问播放音乐的软件的内存。它们要是想要通信，除非使用高级技巧，叫做进程间通信IPC。而线程与线程之间，它们共享就容易多了，因为它们都服务于同一个进程。它们可以直接访问一定量的共享内存，不需要任何额外的处理。
## 拥有资源不同
线程本身是进程的一部分，所以它拥有的资源一定是少于进程的
## 线程共享的内容包括
1.进程的代码段
2.进程的共有数据（利用这些共享的数据，线程很容易的实现相互的通讯）
3.进程打开的文件描述符
4.信号的处理器
5.进程的当前目录
6.进程用户ID与进程组ID
## 线程独有的内容包括（线程不共享的）：
1.线程ID
2.寄存器组的值
3.线程的堆栈
4.错误返回码
5.线程的信号屏蔽码
## 数量不同
## 开销不同
1.线程的创建、终止时间比进程短
2.同一进程内的线程切换时间比进程切换短
3.同一进程的各个线程间共享内存和文件资源，可以不通过内核进行通信

# 相似点
生命周期

# JAVA语言与多线程的关系
java设计支持就支持多线程
java语言在服务端开发语言中的地位
一对一映射到操作系统的内核线程（有些语言的线程是虚拟线程，它不会在操作系统中对应的去创建线程，在java中我们创建100个线程就会实实在在的看到多出来100个线程）

## JVM自动启动线程debugger观察：
Signal Dispatcher：把操作系统发来的信号分发给适当的处理程序
Finalizer：负责对象的finalized()方法【随着java语言的发展finalized方法不在推荐使用】
Reference Handler：和GC、引用相关的线程
main：主线程、用户程序的入口