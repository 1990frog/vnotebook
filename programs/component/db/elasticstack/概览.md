[TOC]

# 搜索原理
+ 独立的网络上的一个或一组进程节点
+ 对外提供搜索服务（http或transport协议【逐步废弃】）
+ 对内就是一个搜索数据库

# 名词定义
+ 索引=数据库
+ 类型(废弃ing)=表
+ 文档=行数据

# ES对比关系型数据库
|   Relational database   |         Elasticsearch         |
| ---------------------- | ---------------------------- |
| Database               | Index(名词)                   |
| Table                  | Type                         |
| Row                    | Document                      |
| Column                 | Field                        |
| Schema                 | Mapping                      |
| Index                  | Everything is indexed（被索引） |
| SQL                    | Query DSL                     |
| select * from table ... | GET http://...                |
| update table set ...    | PUT http://...                |

# 索引
+ 搜索中的数据库或表定义
+ 构建文档时候的索引创建

例子：
书的目录——正排索引
书的索引（关键词）——倒排索引

# 分词
+ 搜索是以词为单位做最基本的搜索单元
+ 依靠分词器构建分词
+ 用分词构建倒排索引

# 正向索引
{xiaoming is chinese}-->{xiaoming},{is},{chinese}
...
[doc]->[word]

# 倒排索引
{xiaoming}-->{}-->{}
{is}-->{}-->{}
{chinese}-->{}-->{}
...
[word]->[doc]

倒排索引是搜索引擎的核心，注意包含两部分：
+ 单词词典（Term Dictionary）
+ 倒排列表（Posting List）

posting包含：
+ 文档id
+ 单词频率（TF）
+ 位置，记录单词在文档中的分词位置（多个），用于做词语搜索（Phrase Query）
+ 偏移，记录单词在文档的开始和结束位置，用于做高亮显示
# TF-IDF打分
+ TF：词频，这个document文档包含了多少个这个词，包含越多表明越相关
+ DF：文档频率，包含改词的文档总数目
+ IDF：DF取反

| 单词id |   单词   | 文档频率 |            倒排列表（DocID;TF;\<POS>）            |
| ----- | -------- | ------ | ---------------------------------------------- |
| 1     | google   | 5       | (1;1;\<1>) ,(2;1;\<1>) ,(3;1;\<1;6>) ,(4;1;\<1>) |
| 2     | facebook | 3       | (1;1;\<2>) ,(4;1;\<1>)                          |
| 3     | linux    | 1       | (2;1;\<10>)                                      |

TF-IDF打分：
google这个词一共出现了5次，df=5，idf=1/5，在文档3中出现了2次，所以它的if-idf=2/5

es还有归一化加权

