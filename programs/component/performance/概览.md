[TOC]

maven打包
上传
外挂配置文件
编写deploy脚本启动


vim deploy.sh
```
nohub java -Xms400m -Xmx400m -XX:NewSize=200 -XX:MaxNewSize=200 -jar jarname.jar --spring.config.addition-location.properties=/../.application.properties
```
chmod -R 777 *
./deploy.sh &


# 容量问题：server端并发线程数上不去
线程访问多被拒绝
```
>pstree -pid 查看线程数量
>pstree -p {pid} | wc -l
>top -H
```

# top命令
cpu:us用户空间，sy系统空间
load average: 0 0 0最近的1分钟，5分钟,15分钟cpu使用率


springBoot配置
spring-configuration-metadata.json文件下查看各个节点的配置

# tomcat配置
+ server.tomcat.accept-count:等待队列长度，默认100
+ server.tomcat.max-connections:最大可被连接数，默认10000
+ server.tomcat.max-threads:最大工作线程数，默认200
+ server.tomcat.min-spare-threads:最小工作线程数，默认10
默认配置下，连接操过10000后出现拒绝连接情况
默认配置下，触发的请求超过200+100后拒绝处理

+ keepAliveTimeOut：多少毫秒后不影响的断开keepalive
+ maxKeepAliveRequests:多少次请求后keepalive断开失效
+ 使用WebServerFactoryCustomizer<ConfigurableServletWebServerFactory>定制化内嵌tomcat配置

# jmeter单机瓶颈

# 单Web容器上限
+ 线程数量：4核cpu 8g内存单线程调度线程数800-1000以上后即花费巨大的时间在cpu调度上
+ 等待队列长度：队列做缓存池用，单页不能无限长，消耗内存，出队入队也耗cpu

# MySQL数据库QPS容量问题
+ 主键查询：千万级别数据 = 1-10毫秒
+ 唯一索引查询：千万级别数据 = 10-100毫秒
+ 非唯一索引查询：千万级别数据 = 100-1000毫秒
+ 无索引：百万条数据 = 1000毫秒+

mysql聚集索引，buffer缓存

# MySQL数据库TPS容量问题
+ 非插入更新删除操作：同查询
+ 插入操作：1w～10w tps（依赖配置优化，后续讲解）

# mysql数据库访问权限
grant all privileges on *.* to root@'%' identified by 'root'


# 开启tomcat access log验证