vnote_backup_file_826537664 /home/cai/Documents/vnote_notebooks/vnotebook/programs/redis/瑞士军刀Redis其他功能.md


# pipeline

![](_v_images/20191126212919787_1218134094.png)


![](_v_images/20191126213048862_6869612.png)

![](_v_images/20191126213157255_1899295068.png)

![](_v_images/20191126213650829_1737934239.png)

![](_v_images/20191126213726549_1944742662.png)


![](_v_images/20191126213909124_470070701.png)

![](_v_images/20191126213926603_1122911941.png)

![](_v_images/20191126214134306_1163908255.png)

# 发布订阅模式
角色：
发布者（publisher）
订阅者（subscriber）
频道（channel）

redis无法消息堆积（获取历史消息）

API
publish
subscribe
unsubscribe
其他

publish channel message
```
redis> publish sohu:tv "hello world"
(integer) 3 #订阅者个数
redis> publish sohu:auto "taxi"
(integer)
```

subscribe [channel] #一个或多个

unsubcribe [channel]

psubscribe [pattern...] #按照模式订阅
punsubscribe [pattern...] #退订指定的模式
pubsub channels #列出至少有一个订阅者的频道
pubsub numsub [channel...] #列出给定频道的订阅者数量
pubsub numpat #列出被订阅模式的数量

![](_v_images/20191126215325109_1459513158.png)

# 消息队列 与 发布订阅

# Bitmap（位图）

![](_v_images/20191126215616213_15912252.png)

setbit key offset value
给位图指定索引设置值

getbit key offset
获取位图指定索引位置

bitcount key [start end]
获取位图指定范围（start到end，单位为字节，如果不指定就是获取全部）位值为1的个数

位图的简单使用：
1.使用set和bitmap
2.1亿用户，5千万独立

![](_v_images/20191126220526666_497178824.png)

![](_v_images/20191126220750184_1272126802.png)

使用经验
type=string，最大512mb
注意setbit时的偏移量，可能有较大耗时
redis单线程

# hyperloglog
基于hyperloglog算法：用极小的空间完成独立数量统计
本质还是字符串
```
type hyperloglog_key
string
```
pfadd key elment[element...] #向hyperloglog添加元素
pfcount key [key...] #计算hyperloglog的独立总数
pfmerge destkey sourcekey[sourcekey...] #合并多个hyperloglog

Demo
![](_v_images/20191126221517728_719402407.png)
![](_v_images/20191126221626479_1923719140.png)

![](_v_images/20191126221756238_1020319763.png)

使用经验

![](_v_images/20191126221920524_81613047.png)

# geo
![](_v_images/20191126222051962_1093131264.png)

![](_v_images/20191126222306542_1073544835.png)

![](_v_images/20191126222344381_1562477292.png)

![](_v_images/20191126222405563_1894627029.png)

![](_v_images/20191126222428484_170719787.png)

![](_v_images/20191126222457612_456545550.png)

![](_v_images/20191126222523513_2146317801.png)