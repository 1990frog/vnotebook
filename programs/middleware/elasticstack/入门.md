[TOC]

# 配置信息
config目录
+ elasticsearch.yml es的相关配置
+ jvm.options jvm的相关参数
+ log4j2.properties 日志相关配置

# elasticsearch.yml
cluster.name 集群名称，以此作为是否同一集群的判断条件
node.name 节点名称，以此作为集群中不同节点的区分条件
network.host/http.port 网络地址和端口，用于http和transport服务
path.data 数据存储地址
path.log 日志存储地址

# Development模式与Production模式
+ Development模式下在启动时会以warning的方式提示配置检查异常
+ Production模式下在启动时会以error的方式提示配置检查异常并退出

# 命令
```
>bin/elasticsearch -Ehttp.port=19200
```
快速启动一个Elasticsearch集群
```
>bin/elasticsearch
>bin/elasticsearch -Ehttp.port=8200 -Epath.data=node2
>bin/elasticsearch -Ehttp.port=7200 -Epath.data=node3
```

# Kibana
localhost:5601

## 配置
配置位于config文件夹中
kibana.yml关键配置说明
server.host/server.port 访问kibana用的地址和端口
elasticsearch.url带访问elasticsearch的地址

## 常用功能
Discover数据搜索查看
Visualize图表制作
Dashboard仪表盘制作
Timelion时序数据的高级可视化分析
DevTools开发者工具
Management配置

# Elasticsearch常用术语
Document文档数据
Index索引
Type索引中的数据类型
Field字段，文档的属性
Query DSL查询语法

# Elasticsearch CRUB
Create
Read
Update
Delete

![](_v_images/20200221183725917_1057732633.png)

![](_v_images/20200221183833372_64294361.png)

获取文档
GET accounts/persion/1

![](_v_images/20200221183931672_1156771400.png)

![](_v_images/20200221184009731_1935721276.png)

![](_v_images/20200221184046099_1792918728.png)

# Beats
Lightweight Data Shipper
+ Filebeat日志文件
+ Metricbeat度量数据
+ Packetbeat网络数据
+ Winlogbeat Windows数据
+ Heartbeat健康检查

![20190911084149342](_v_images/20200222191043742_986810788.png)

## Filebeat
处理流程
+ 输入Input
+ 处理Filter
+ 输出Output

### 配置
yaml语法：
input_type:log,stdin
```yml
filebeat.prospectors:
    -input_type:log
    paths:
        -/var/log/apache/httpd-*.log
    -input_type:log
    paths:
        -/var/log/messages
        -/var/log/*.log
```
output:
+ Console
+ Elasticsearch
+ Logstash
+ Kafka
+ Resi
+ File

```yml
output.elasticsearch:
    hosts:["http://localhsot:9200"]
    username:"admin"
    password:"123"
```

```yml
output.console
    pretty:true
```

# Filebeat Filter
## Input时处理
+ Include_lines
+ exclude_lines
+ exclude_files

## Output前处理--Processor
+ drop_event
+ drop_fields
+ Decode_json_fields
+ Include_fields

```yml
processors:
    - drop_event:
        when:
            regexp:
                message:"^DCG:"
```

```yml
processors:
    -decode_json_fields:
        fields:["inner"]
```

# Filebeat+Elasticsearch Ingest Node
+ Filebeat缺乏数据转换的能力
+ Elasticsearch Ingest Node
新增的node类型
在数据写入es前对数据进行处理转换
pipeline api

# Filebeat Module
对于社区常见需求进行配置封装增加易用性

# demo
filebeat收集nginx log
通过stdin收集日志
通过console输出结果

```yml
filebeat.prospectors:
    input_type:stdin
    output_type.console:
        pretty:true
```

```
>head -n 2 /nginx.log ./filebeat -e -c nginx.yml
```

# packetbeat
实时抓取网络包
自动解析应用层协议
ICMP
DNS
HTTP
MySQL
Redis
......

Wireshark

## 解析Elasticsearch http请求
```yml
packetbeat.interfaces.device:any
packetbeat.protocols.http:port:[9200]
send_request:true
include_body_for:["application/json","x-www-form-urlencoded"]
output.console:
    pretty:true
```

```
>sudo ./packetbeat -e -c es.yml -strict.perms=false
```

down packetbeat
down filebeat