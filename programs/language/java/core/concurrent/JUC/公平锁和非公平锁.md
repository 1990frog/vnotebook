[TOC]

# 概览
+ 公平指的是按照线程请求的顺序，来分配锁；非公平指的是，不完全按照请求的顺序，在一定情况下，可以插队
+ 注意：非公平也同样不提倡“插队”行为，这里的非公平，指的是“在合适的时机”插队，而不是盲目插队
+ 什么是合适的时机呢？
+ 火车票被插队的例子

# 为什么要有非公平锁
为了提高效率，避免唤醒带来的空档期

唤醒的开销很大，在此期间利用空档期提高吞吐量

女神找不到男朋友之间备胎来补救

# 公平的情况（以ReentrantLock为例）
如果在创建ReentrantLock对象时，参数填写为true，那么这就是个公平锁

+ 在线程1执行unlock()释放锁之后，由于此时线程2的等待时间最久，所以线程2先得到执行，然后是线程3和线程4

# 不公平的情况（以ReentrantLock为例）
+ 如果在线程1释放锁的时候，线程5恰好去执行lock()
+ 由于ReentrantLock发现此时并没有线程持有lock这把锁（线程2还没来得及获取到，因为获取需要时间）
+ 线程5可以插队，直接拿到这把锁，这也是ReentrantLock默认的公平策略，也就是“不公平”

# 特例
+ 针对tryLock()方法，它是很猛的，它不遵守设定的公平规则
+ 例如，当有线程执行tryLock()时候，一旦有线程释放了锁，那么这个正在tryLock的线程就能获取到锁，即使在它之前已经有其他线程现在在等待队列里了

# 对比公平和非公平的优缺点
|          |                           优势                           |                             劣势                             |
| -------- | -------------------------------------------------------- | ------------------------------------------------------------ |
| 公平锁   | 各线程公平平等，每个线程在等待一段时间后，总有执行的机会 | 更慢，吞吐量更小                                             |
| 非公平锁 | 更快，吞吐量更大                                         | 有可能产生线程饥饿，也就是某些线程在长时间内，始终得不到执行 |